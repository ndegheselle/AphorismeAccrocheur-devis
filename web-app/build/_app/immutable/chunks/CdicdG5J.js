var g=Object.defineProperty;var R=(t,e,a)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var s=(t,e,a)=>R(t,typeof e!="symbol"?e+"":e,a);import{b as l,d as i,a as u,c as o,I as p,P as m,R as f,Q as r}from"./CjwIIwk2.js";import{c as D}from"./Dy5JpXxM.js";import{P as x}from"./C6FzuqNZ.js";function h(t){return Math.round(t*100)/100}function S(t){return t?t.toISOString().split("T")[0]:""}function y(t,e){let a="";for(let n=0;n<t;n++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}function A(){return`${y(3,"ABCDEFGHIJKLMNOPQRSTUVWXYZ")}-${y(6,"0123456789")}`}class I{constructor(){s(this,"name");s(this,"unitPrice",1);s(this,"quantity",1);s(this,"tax",20);s(this,"discount",0)}get totalWithoutTax(){return this.unitPrice*this.quantity*(1-this.discount/100)}get totalTax(){return this.totalWithoutTax*this.tax/100}get total(){return this.totalWithoutTax+this.totalTax}}class w{constructor(){s(this,"$id");s(this,"reference","REF-0001");s(this,"issueDate");s(this,"validityDate");s(this,"clientId");s(this,"lines",[]);s(this,"isBilled",!1)}get totalWithoutTax(){return h(this.lines.reduce((e,a)=>e+a.totalWithoutTax,0))}get totalTax(){return h(this.lines.reduce((e,a)=>e+a.totalTax,0))}get total(){return h(this.totalWithoutTax+this.totalTax)}}async function v(t){if(l.currentUser==null)throw new Error("User is not connected.");let e=await i.createDocument(u,o.estimates,p.unique(),t,[m.read(f.user(l.currentUser.$id)),m.update(f.user(l.currentUser.$id)),m.delete(f.user(l.currentUser.$id))]);return D(w,e)}async function P(t,e,a){let n=await i.listDocuments(u,o.estimates,[r.limit(a),r.offset((e-1)*a),r.or([r.contains("reference",t)])]),d=n.documents.map(T=>c(T));return new x(d,n.total,e,a)}async function W(t,e){let a=await i.listDocuments(u,o.estimates,[r.limit(e),r.offset((t-1)*e)]),n=a.documents.map(d=>c(d));return new x(n,a.total,t,e)}async function E(t){return(await i.listDocuments(u,o.estimates,[r.equal("clientId",t)])).documents.map(n=>c(n))}async function U(t){let e=await i.getDocument(u,o.estimates,t);return c(e)}function c(t){return t.issueDate=t.issueDate?new Date(t.issueDate):null,t.validityDate=t.validityDate?new Date(t.validityDate):null,t=D(w,t),t.lines=t.lines.map(e=>D(I,e)),t}async function $(t){await i.deleteDocument(u,o.estimates,t)}async function b(t){await i.updateDocument(u,o.estimates,t,{isBilled:!0})}const Q={create:v,search:P,getAll:W,getByClient:E,getById:U,remove:$,bill:b};export{I as E,w as a,h as b,A as c,S as f,Q as r};
